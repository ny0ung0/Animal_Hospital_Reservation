<!DOCTYPE html>
<html class="h-100" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>ê²¬ê°•í• ê³ ì–‘</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<link href="/css/style.css" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&family=Jua&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link href="/css/myPetList.css" rel="stylesheet">
<link href="/css/customerList.css" rel="stylesheet">
</head>
<body class="d-flex flex-column h-100">
<div th:replace="~{hospital/header :: header}"></div>
<div class="container-xl">
	<h1 class="mt-3 mt-md-5 mb-3 mb-md-3">ê´€ë¦¬ ê³ ê° ìƒì„¸ë³´ê¸°</h1>
	<h1 class="fs-4 mb-2">ğŸ¾ ë°˜ë ¤ë™ë¬¼ ì •ë³´</h1>
	<div class="border p-4 rounded">
		<div class="row">
			<div class="col-md-4">
				<div class="mx-auto" style="width:300px;">
					<img id="petPhoto" src="" class="img-thumbnail img-fluid" alt="ë°˜ë ¤ë™ë¬¼ì‚¬ì§„">
				</div>
			</div>
			<div class="col-md-8">
				<div class="row mb-2 px-md-5">
					<div class="col-4 text-secondary">ì¢…ë¥˜</div>
					<div class="col-8" id="petType">ê°•ì•„ì§€</div>
				</div>
				<div class="row mb-2 px-md-5">
					<div class="col-4 text-secondary">ì´ë¦„</div>
					<div class="col-8" id="petName">ì´ë¦„</div>
				</div>
				<div class="row mb-2 px-md-5">
					<div class="col-4 text-secondary">ìƒë…„ì›”ì¼</div>
					<div class="col-8" id="petBirthdate">2020.07.05(4ì„¸)</div>
				</div>
				<div class="row mb-2 px-md-5">
					<div class="col-4 text-secondary">ì„±ë³„</div>
					<div class="col-8" id="petGender">ì—¬ì•„</div>
				</div>
				<div class="row mb-2 px-md-5">
					<div class="col-4 text-secondary">ì¤‘ì„±í™” ì—¬ë¶€</div>
					<div class="col-8" id="petIsNeutred">Y</div>
				</div>
				<div class="row mb-2 px-md-5">
					<div class="col-4 text-secondary">ëª¸ë¬´ê²Œ</div>
					<div class="col-8"><span id="petWeight">5kg</span>kg</div>
				</div>
				<div class="row mb-2 px-md-5">
					<div class="col-4 text-secondary">íŠ¹ì´ì‚¬í•­</div>
					<div class="col-8"><span id="issue">5ddd</span></div>
				</div>
			</div>
		</div>
	</div>
	<h1 class="fs-4 mb-2 mt-4">ğŸ™‚ ë³´í˜¸ì ì •ë³´</h1>
	<div class="border p-4 rounded">
		<div class="row mb-2 px-md-5">
			<div class="col-4 text-secondary">ì´ë¦„</div>
			<div class="col-8" id="userName">dd</div>
		</div>
		<div class="row mb-2 px-md-5">
			<div class="col-4 text-secondary">ì—°ë½ì²˜</div>
			<div class="col-8" id="phone">dd</div>
		</div>
		<div class="row mb-2 px-md-5">
			<div class="col-4 text-secondary">ì£¼ì†Œ</div>
			<div class="col-8" id="address">dd</div>
		</div>
	</div>
	<h1 class="fs-4 mb-2 mt-4">ğŸ”ì§„ë£Œ(ì˜ˆì•½) ë¦¬ìŠ¤íŠ¸</h1>
	<div class="row mb-5" id="reservation-content">
		<nav aria-label="Page navigation example" id="reservation-pagination">
	        <ul class="pagination justify-content-center">
	            <li class="page-item prev-btn"><a class="page-link prev-btn2" data-page="" data-status="cancle" href="#">ì´ì „</a></li>
	            <li class="page-item next-btn"><a class="page-link next-btn2" data-page="" data-status="cancle" href="#">ë‹¤ìŒ</a></li>
	        </ul>
	    </nav>
	</div>
</div>
<div th:replace="~{hospital/footer :: footer}"></div>

<script type="text/javascript">
const token = localStorage.getItem("token");
const memberId = localStorage.getItem("MemberId");
const petId = [[${petId}]];
console.log(petId);
fetch("http://localhost:9001/api/v1/hospital/pet/" + petId, {
	method : "GET",
	headers : {
		'Authorization' : token
	}
})
.then(response =>{
		fetchResponseCheck(response);
		return response.text();
})
.then(data => {
	const pet = JSON.parse(data);
	console.log(pet);
	let isNeutered = "";
	let gender = "";
	pet.isNeutered ? isNeutered = "Y" : isNeutered = "N";
	pet.gender=="female" ? gender = "ì—¬ì•„" : gender = "ë‚¨ì•„";
    const utcDate = new Date(pet.birthdate);
    const localDate = new Date(utcDate.getTime() - new Date().getTimezoneOffset() * 60000);
	let birthdate = localDate.toISOString().split('T')[0];
	if(pet.photo == null){
		document.getElementById("petPhoto").setAttribute("src", "/images/no_image.jpg");
	}else{
		document.getElementById("petPhoto").setAttribute("src", "/images/user/"+pet.photo);
	}
	let address = pet.member.address.replace(/\/\//g, " ");
	document.getElementById("petType").innerHTML = pet.type;
	document.getElementById("petName").innerHTML = pet.name;
	document.getElementById("petBirthdate").innerHTML = birthdate;
	document.getElementById("petGender").innerHTML = gender;
	document.getElementById("petIsNeutred").innerHTML = isNeutered;
	document.getElementById("petWeight").innerHTML = pet.weight;
	document.getElementById("issue").innerHTML = pet.healthIssues;
	document.getElementById("userName").innerHTML = pet.member.name;
	document.getElementById("phone").innerHTML = pet.member.phone;
	document.getElementById("address").innerHTML = address;
	
})
.catch(error => console.log(error));


fetch("http://localhost:9001/api/v1/hospital/reservation/pet/" + petId, {
	method : "GET",
	headers : {
		'Authorization' : token,
		'memberId' : memberId
	}
})
.then(response =>{
		fetchResponseCheck(response);
		return response.json();
})
.then(data =>{
	
	const tabContent = document.querySelector("#reservation-content");
	if (data.content.length === 0) {
        tabContent.innerHTML = 
            '<div class="col-12 mb-3"><div class="p-5 text-center text-secondary">ì˜ˆì•½ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div></div>';
		tabPagination.style.display="none";
    } else {
        let content = '';
        data.content.forEach(obj => {
            let minute = obj.reservationDatetime[4].toString().length === 1 ? obj.reservationDatetime[4] + '0' : obj.reservationDatetime[4];
            let dateTime = `${obj.reservationDatetime[0]}-${obj.reservationDatetime[1]}-${obj.reservationDatetime[2]} ${obj.reservationDatetime[3]}:${minute}`;
            content += 
                `<div class="col-12 col-md-4 mb-3">
                    <div class="p-3 p-md-4 border rounded">
                        <div class="mb-2"><span class="fw-bold">[ì˜ˆì•½ë²ˆí˜¸] ${obj.id}</span></div>
                        <div class="mb-2"><span class="fw-bold">ì§„ë£Œìœ í˜• </span>${obj.type}</div>
                        <div class="mb-2"><span class="fw-bold">ì˜ˆì•½ìëª… </span>${obj.user.name}</div>
                        <div class="mb-2"><span class="fw-bold">ì˜ˆì•½ë‚ ì§œ </span>${dateTime}</div>
                        <div class="d-flex">
                            <a class="btn btn-sm btn-main w-100" href="/hospital/reservDetail?id=${obj.id}">ìƒì„¸ë³´ê¸°</a>
                        </div>
                    </div>
                </div>`;
        });
        tabContent.innerHTML = content;
    }
})
.catch(error => console.log(error));
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
