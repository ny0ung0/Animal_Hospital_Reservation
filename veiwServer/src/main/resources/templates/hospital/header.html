<header class="border-bottom" th:fragment="header">
	<div class="d-flex bg-hospital-sub p-2 px-3">
		<div class="ms-auto d-flex">
		<a id="chat" href="/hospital/chatList" class="navbar-brand me-4" style="display:none;">ğŸ’¬ ì±—íŒ…</a>
		<a id="login-link" class="navbar-brand" href="/login_form">ë¡œê·¸ì¸</a>
		 <a id="logout-link" class="navbar-brand" href="#" onclick="logout()" style="display: none;">ë¡œê·¸ì•„ì›ƒ</a>
		<span class="mx-3"id ="bar"> | </span>
		<a id="register-link" class="navbar-brand" href="/register_form">íšŒì›ê°€ì…</a>
		</div>
	</div>
	<div class="d-flex flex-wrap justify-content-center align-items-center py-3">
      <a href="/hospital" class="d-flex align-items-center mb-md-0 me-md-auto ps-md-3 link-body-emphasis text-decoration-none">
      <div class="logo_size">
        <img src="/images/logo_hospital.png" class="w-100" alt="ë¡œê³ ">
        </div>
        
      </a>

      <ul class="nav nav-pills hospital-nav">
        <li class="nav-item"><a href="/hospital/my_info_edit" class="nav-link fs-5" aria-current="page">ë‚´ ì •ë³´ ìˆ˜ì • </a></li>
        <li class="nav-item"><a href="/hospital/my_qna_list" class="nav-link fs-5">ë¬¸ì˜ë‚´ì—­</a></li>
        <li class="nav-item">
	        <div class="dropdown">
			  <a class="btn btn-none dropdown-toggle nav-link fs-5" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
			   ì˜ˆì•½ ê´€ë¦¬
			  </a>
			
			  <ul class="dropdown-menu">
				<li><a class="dropdown-item" href="/hospital">ì „ì²´ ì§„ë£Œ ì¼ì •</a></li>
			    <li><a class="dropdown-item" href="/hospital/reservList">ì˜ˆì•½ ê³ ê° ë¦¬ìŠ¤íŠ¸</a></li>
			    <li><a class="dropdown-item" href="/hospital/reserveDocSelect">ì§„ë£Œ ì¼ì • ê´€ë¦¬</a></li>
			  </ul>
			</div>
		</li>
        <li class="nav-item"><a href="/hospital/notification" class="nav-link fs-5">ì•Œë¦¼ì„¤ì •</a></li>
        <li class="nav-item"><a href="/hospital/chatList" class="nav-link fs-5">ë¬¸ì˜ì±„íŒ…</a></li>
        <li class="nav-item"><a href="#" class="nav-link fs-5">ê´‘ê³ ê³„ì•½</a></li>
        <li class="nav-item">
	        <div class="dropdown">
			  <a class="btn btn-none dropdown-toggle nav-link fs-5" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
			   ê³ ê°ì„¼í„°
			  </a>
			
			  <ul class="dropdown-menu">
			    <li><a class="dropdown-item" href="/noticeList">ê³µì§€ì‚¬í•­</a></li>
			    <li><a class="dropdown-item" href="/qnaForm">ë¬¸ì˜ì‘ì„±</a></li>
			  </ul>
			</div>
		</li>
      </ul>
	</div>
	<script src="https://www.gstatic.com/firebasejs/9.9.3/firebase-app-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/9.9.3/firebase-messaging-compat.js"></script>
	<script src="/js/fcm.js"></script>
	<script src="/js/fcmsend.js"></script>
	<script>
            function logout() {
                localStorage.clear();
                window.location.href = "/";
            }
            
            document.addEventListener("DOMContentLoaded", function() {
                const memberId = localStorage.getItem('MemberId');
                const loginLink = document.getElementById('login-link');
                const registerLink = document.getElementById('register-link');
                const logoutLink = document.getElementById('logout-link');
                const bar = document.getElementById('bar');
                const chat = document.getElementById('chat');
                if (memberId) {
                    loginLink.style.display = 'none';
                    registerLink.style.display = 'none';
                    logoutLink.style.display = '';
                    bar.style.display = 'none';
                    chat.style.display = '';
                } else {
                    loginLink.style.display = '';
                    registerLink.style.display = '';
                    logoutLink.style.display = 'none';
                    bar.style.display = '';
                    chat.style.display = 'none';
                }
                
             	// í˜„ì¬ URL ê°€ì ¸ì˜¤ê¸°
        	    const currentPath = window.location.pathname;
        		console.log(currentPath);	
        	    // ëª¨ë“  nav-link ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        	    const navLinks = document.querySelectorAll('.nav-link');

        	    // ê° nav-link ìš”ì†Œì— ëŒ€í•´ í˜„ì¬ URLê³¼ ë¹„êµí•˜ì—¬ active í´ë˜ìŠ¤ ì¶”ê°€
        	    navLinks.forEach(function (link) {
        	        if (link.getAttribute('href') === currentPath) {
        	            link.classList.add('active-pet');
        	        }
        	    });

        	    // ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ë‚´ë¶€ì˜ ë§í¬ì— ëŒ€í•´ì„œë„ ê°™ì€ ì‘ì—… ìˆ˜í–‰
        	    const dropdownItems = document.querySelectorAll('.dropdown-item');
        	    dropdownItems.forEach(function (item) {
        	        if (item.getAttribute('href') === currentPath) {
        	            item.classList.add('active-pet');
        	            // ë¶€ëª¨ ë“œë¡­ë‹¤ìš´ ë§í¬ì—ë„ active í´ë˜ìŠ¤ ì¶”ê°€
        	            item.closest('.dropdown').querySelector('.dropdown-toggle').classList.add('active-pet');
        	        }
        	    });
        	    
        	    
            	if (currentPath.includes('/hospital/reservDetail')) {
        	        const parentMenuLink = document.querySelector('a[href="/hospital/reservList"]');
        	        dropdownItems.forEach(function (item) {
            	        if (item.getAttribute('href') === parentMenuLink.getAttribute('href')) {
            	            item.classList.add('active-pet');
            	            // ë¶€ëª¨ ë“œë¡­ë‹¤ìš´ ë§í¬ì—ë„ active í´ë˜ìŠ¤ ì¶”ê°€
            	            item.closest('.dropdown').querySelector('.dropdown-toggle').classList.add('active-pet');
            	        }
            	    });
        	    }
            	
            	if (currentPath.includes('/hospital/reserveCalender')) {
        	        const parentMenuLink = document.querySelector('a[href="/hospital/reserveDocSelect"]');
        	        dropdownItems.forEach(function (item) {
            	        if (item.getAttribute('href') === parentMenuLink.getAttribute('href')) {
            	            item.classList.add('active-pet');
            	            // ë¶€ëª¨ ë“œë¡­ë‹¤ìš´ ë§í¬ì—ë„ active í´ë˜ìŠ¤ ì¶”ê°€
            	            item.closest('.dropdown').querySelector('.dropdown-toggle').classList.add('active-pet');
            	        }
            	    });
        	    }
            	
            	if (currentPath.includes('/hospital/reserveSchedule')) {
        	        const parentMenuLink = document.querySelector('a[href="/hospital/reserveDocSelect"]');
        	        dropdownItems.forEach(function (item) {
            	        if (item.getAttribute('href') === parentMenuLink.getAttribute('href')) {
            	            item.classList.add('active-pet');
            	            // ë¶€ëª¨ ë“œë¡­ë‹¤ìš´ ë§í¬ì—ë„ active í´ë˜ìŠ¤ ì¶”ê°€
            	            item.closest('.dropdown').querySelector('.dropdown-toggle').classList.add('active-pet');
            	        }
            	    });
        	    }
                
            });
            
            function responseCheck(response){
        		 const msg =response.getResponseHeader("msg");
        		 if(msg && msg=="tokenExpired"){
        				alert("ë¡œê·¸ì¸ ì‹œê°„ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.ë‹¤ì‹œ ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.");
        				 localStorage.clear();
        				 window.location.href="/login_form";
        			}
        		 if(response.status ==401){
        			 alert("ì‚¬ìš©ì ì •ë³´ ì¸ì¦ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.");
        			 window.location.href="/login_form";
        		 }else if(response.status ==403){
        			 alert("ì ‘ê·¼ ê°€ëŠ¥í•œ í˜ì´ì§€ê°€ ì•„ë‹™ë‹ˆë‹¤.");
        			if(localStorage.getItem("role")=="ROLE_HOSPITAL"){
       				 window.location.href="/hospital";
       			 }else{
       	 			 window.location.href="/";
       				 }
        		 }else if(response.status ==400){
        			 alert("ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.")
        			if(localStorage.getItem("role")=="ROLE_HOSPITAL"){
       				 window.location.href="/hospital";
       			 }else{
        				 window.location.href="/";
       			 }
        		 }
          }
         	 function fetchResponseCheck(response){
        		 const msg =response.headers.get("msg");
        		 if(msg && msg=="tokenExpired"){
        				alert("ë¡œê·¸ì¸ ì‹œê°„ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.ë‹¤ì‹œ ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.");
        				 localStorage.clear();
        				 window.location.href="/login_form";
        			}
        		 if(response.status ==401){
        			 alert("ì‚¬ìš©ì ì •ë³´ ì¸ì¦ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.");
        			 window.location.href="/login_form";
        		 }else if(response.status ==403){
        			 alert("ì ‘ê·¼ ê°€ëŠ¥í•œ í˜ì´ì§€ê°€ ì•„ë‹™ë‹ˆë‹¤.");
        			 if(localStorage.getItem("role")=="ROLE_HOSPITAL"){
        				 window.location.href="/hospital";
        			 }else{
       	 			 window.location.href="/";
       			 }
        		 }else if(response.status ==400){
        			 alert("ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.")
        			if(localStorage.getItem("role")=="ROLE_HOSPITAL"){
       				 window.location.href="/hospital";
       			 }else{
       	 			 window.location.href="/";
       			 }
        		 }
          }
        </script>
</header>
